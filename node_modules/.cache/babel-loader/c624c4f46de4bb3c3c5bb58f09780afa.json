{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\shrey\\\\Desktop\\\\ReactProject\\\\Newsy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\shrey\\\\Desktop\\\\ReactProject\\\\Newsy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:\\\\Users\\\\shrey\\\\Desktop\\\\ReactProject\\\\Newsy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:\\\\Users\\\\shrey\\\\Desktop\\\\ReactProject\\\\Newsy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\shrey\\\\Desktop\\\\ReactProject\\\\Newsy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React from\"react\";import firebase from\"../firebase\";import{Plugins}from\"@capacitor/core\";import UserContext from\"../contexts/UserContext\";import{IonPage,IonContent,IonGrid,IonRow,IonCol,IonButton}from\"@ionic/react\";import NavHeader from\"../components/Header/NavHeader\";import{closeCircleOutline}from\"ionicons/icons\";import LinkItem from\"../components/Link/LinkItem\";import CommentModal from\"../components/Link/CommentModal\";import LinkComment from\"../components/Link/LinkComment\";var Browser=Plugins.Browser;var Link=function Link(props){var _React$useContext=React.useContext(UserContext),user=_React$useContext.user;var _React$useState=React.useState(null),_React$useState2=_slicedToArray(_React$useState,2),link=_React$useState2[0],setLink=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),showModal=_React$useState4[0],setShowModal=_React$useState4[1];var linkId=props.match.params.linkId;var linkRef=firebase.db.collection(\"links\").doc(linkId);React.useEffect(function(){getLink();// eslint-disable-next-line\n},[linkId]);function getLink(){linkRef.get().then(function(doc){setLink(_objectSpread(_objectSpread({},doc.data()),{},{id:doc.id}));});}function handleOpenModal(){if(!user){props.history.push(\"/login\");}else{setShowModal(true);}}function handleCloseModal(){setShowModal(false);}function handleAddComment(commentText){if(!user){props.history.push(\"/login\");}else{linkRef.get().then(function(doc){if(doc.exists){var previousComments=doc.data().comments;var newComment={postedBy:{id:user.uid,name:user.displayName},created:Date.now(),text:commentText};var updatedComments=[].concat(_toConsumableArray(previousComments),[newComment]);linkRef.update({comments:updatedComments});setLink(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{comments:updatedComments});});}});setShowModal(false);}}function handleAddVote(){if(!user){props.history.push(\"/login\");}else{linkRef.get().then(function(doc){if(doc.exists){var previousVotes=doc.data().votes;var vote={votedBy:{id:user.uid,name:user.displayName}};var updatedVotes=[].concat(_toConsumableArray(previousVotes),[vote]);var voteCount=updatedVotes.length;linkRef.update({votes:updatedVotes,voteCount:voteCount});setLink(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{votes:updatedVotes,voteCount:voteCount});});}});}}function handleDeleteLink(){linkRef.delete().then(function(){console.log(\"Document with ID \".concat(link.id,\" deleted\"));}).catch(function(err){console.error(\"Error deleting document\",err);});props.history.push(\"/\");}function postedByAuthUser(link){return user&&user.uid===link.postedBy.id;}function openBrowser(){return _openBrowser.apply(this,arguments);}function _openBrowser(){_openBrowser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Browser.open({url:link.url});case 2:case\"end\":return _context.stop();}}},_callee);}));return _openBrowser.apply(this,arguments);}return/*#__PURE__*/React.createElement(IonPage,null,/*#__PURE__*/React.createElement(NavHeader,{title:link&&link.description,option:link&&postedByAuthUser(link),icon:closeCircleOutline,action:handleDeleteLink}),/*#__PURE__*/React.createElement(IonContent,null,/*#__PURE__*/React.createElement(CommentModal,{isOpen:showModal,title:\"New Comment\",sendAction:handleAddComment,closeAction:handleCloseModal}),link&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(IonGrid,null,/*#__PURE__*/React.createElement(IonRow,null,/*#__PURE__*/React.createElement(IonCol,{class:\"ion-text-center\"},/*#__PURE__*/React.createElement(LinkItem,{link:link,browser:openBrowser}),/*#__PURE__*/React.createElement(IonButton,{onClick:function onClick(){return handleAddVote();},size:\"small\"},\"Upvote\"),/*#__PURE__*/React.createElement(IonButton,{onClick:function onClick(){return handleOpenModal();},size:\"small\"},\"Comment\")))),link.comments.map(function(comment,index){return/*#__PURE__*/React.createElement(LinkComment,{key:index,comment:comment,link:link,setLink:setLink});}))));};export default Link;","map":{"version":3,"sources":["C:/Users/shrey/Desktop/ReactProject/Newsy/src/pages/Link.js"],"names":["React","firebase","Plugins","UserContext","IonPage","IonContent","IonGrid","IonRow","IonCol","IonButton","NavHeader","closeCircleOutline","LinkItem","CommentModal","LinkComment","Browser","Link","props","useContext","user","useState","link","setLink","showModal","setShowModal","linkId","match","params","linkRef","db","collection","doc","useEffect","getLink","get","then","data","id","handleOpenModal","history","push","handleCloseModal","handleAddComment","commentText","exists","previousComments","comments","newComment","postedBy","uid","name","displayName","created","Date","now","text","updatedComments","update","prevState","handleAddVote","previousVotes","votes","vote","votedBy","updatedVotes","voteCount","length","handleDeleteLink","delete","console","log","catch","err","error","postedByAuthUser","openBrowser","open","url","description","map","comment","index"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport firebase from \"../firebase\";\r\nimport { Plugins } from \"@capacitor/core\";\r\nimport UserContext from \"../contexts/UserContext\";\r\nimport {\r\n  IonPage,\r\n  IonContent,\r\n  IonGrid,\r\n  IonRow,\r\n  IonCol,\r\n  IonButton,\r\n} from \"@ionic/react\";\r\nimport NavHeader from \"../components/Header/NavHeader\";\r\nimport { closeCircleOutline } from \"ionicons/icons\";\r\nimport LinkItem from \"../components/Link/LinkItem\";\r\nimport CommentModal from \"../components/Link/CommentModal\";\r\nimport LinkComment from \"../components/Link/LinkComment\";\r\n\r\nconst { Browser } = Plugins;\r\n\r\nconst Link = (props) => {\r\n  const { user } = React.useContext(UserContext);\r\n  const [link, setLink] = React.useState(null);\r\n  const [showModal, setShowModal] = React.useState(false);\r\n  const linkId = props.match.params.linkId;\r\n  const linkRef = firebase.db.collection(\"links\").doc(linkId);\r\n\r\n  React.useEffect(() => {\r\n    getLink();\r\n    // eslint-disable-next-line\r\n  }, [linkId]);\r\n\r\n  function getLink() {\r\n    linkRef.get().then((doc) => {\r\n      setLink({ ...doc.data(), id: doc.id });\r\n    });\r\n  }\r\n\r\n  function handleOpenModal() {\r\n    if (!user) {\r\n      props.history.push(\"/login\");\r\n    } else {\r\n      setShowModal(true);\r\n    }\r\n  }\r\n\r\n  function handleCloseModal() {\r\n    setShowModal(false);\r\n  }\r\n\r\n  function handleAddComment(commentText) {\r\n    if (!user) {\r\n      props.history.push(\"/login\");\r\n    } else {\r\n      linkRef.get().then((doc) => {\r\n        if (doc.exists) {\r\n          const previousComments = doc.data().comments;\r\n          const newComment = {\r\n            postedBy: { id: user.uid, name: user.displayName },\r\n            created: Date.now(),\r\n            text: commentText,\r\n          };\r\n          const updatedComments = [...previousComments, newComment];\r\n          linkRef.update({ comments: updatedComments });\r\n          setLink((prevState) => ({\r\n            ...prevState,\r\n            comments: updatedComments,\r\n          }));\r\n        }\r\n      });\r\n      setShowModal(false);\r\n    }\r\n  }\r\n\r\n  function handleAddVote() {\r\n    if (!user) {\r\n      props.history.push(\"/login\");\r\n    } else {\r\n      linkRef.get().then((doc) => {\r\n        if (doc.exists) {\r\n          const previousVotes = doc.data().votes;\r\n          const vote = { votedBy: { id: user.uid, name: user.displayName } };\r\n          const updatedVotes = [...previousVotes, vote];\r\n          const voteCount = updatedVotes.length;\r\n          linkRef.update({ votes: updatedVotes, voteCount });\r\n          setLink((prevState) => ({\r\n            ...prevState,\r\n            votes: updatedVotes,\r\n            voteCount: voteCount,\r\n          }));\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function handleDeleteLink() {\r\n    linkRef\r\n      .delete()\r\n      .then(() => {\r\n        console.log(`Document with ID ${link.id} deleted`);\r\n      })\r\n      .catch((err) => {\r\n        console.error(\"Error deleting document\", err);\r\n      });\r\n    props.history.push(\"/\");\r\n  }\r\n\r\n  function postedByAuthUser(link) {\r\n    return user && user.uid === link.postedBy.id;\r\n  }\r\n\r\n  async function openBrowser() {\r\n    await Browser.open({\r\n      url: link.url,\r\n    });\r\n  }\r\n\r\n  return (\r\n    <IonPage>\r\n      <NavHeader\r\n        title={link && link.description}\r\n        option={link && postedByAuthUser(link)}\r\n        icon={closeCircleOutline}\r\n        action={handleDeleteLink}\r\n      />\r\n      <IonContent>\r\n        <CommentModal\r\n          isOpen={showModal}\r\n          title=\"New Comment\"\r\n          sendAction={handleAddComment}\r\n          closeAction={handleCloseModal}\r\n        />\r\n        {link && (\r\n          <>\r\n            <IonGrid>\r\n              <IonRow>\r\n                <IonCol class=\"ion-text-center\">\r\n                  <LinkItem link={link} browser={openBrowser} />\r\n                  <IonButton onClick={() => handleAddVote()} size=\"small\">\r\n                    Upvote\r\n                  </IonButton>\r\n                  <IonButton onClick={() => handleOpenModal()} size=\"small\">\r\n                    Comment\r\n                  </IonButton>\r\n                </IonCol>\r\n              </IonRow>\r\n            </IonGrid>\r\n            {link.comments.map((comment, index) => (\r\n              <LinkComment\r\n                key={index}\r\n                comment={comment}\r\n                link={link}\r\n                setLink={setLink}\r\n              />\r\n            ))}\r\n          </>\r\n        )}\r\n      </IonContent>\r\n    </IonPage>\r\n  );\r\n};\r\n\r\nexport default Link;\r\n"]},"metadata":{},"sourceType":"module"}