{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\shrey\\\\Desktop\\\\ReactProject\\\\Newsy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\shrey\\\\Desktop\\\\ReactProject\\\\Newsy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\shrey\\\\Desktop\\\\ReactProject\\\\Newsy\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React from\"react\";import UserContext from\"../../contexts/UserContext\";import useForm from\"../../hooks/useForm\";import{toast}from\"../../helpers/toast\";import{IonPage,IonLoading,IonContent,IonItem,IonLabel,IonInput,IonRow,IonCol,IonButton}from\"@ionic/react\";import NavHeader from\"../../components/Header/NavHeader\";import firebase from\"../../firebase\";import validateEditProfile from\"../../validators/validateEditProfile\";var EditProfile=function EditProfile(props){var _React$useContext=React.useContext(UserContext),user=_React$useContext.user,setUser=_React$useContext.setUser;var INITIAL_STATE={name:user&&user.displayName,email:user&&user.email,newPassword:\"\",currentPassword:\"\"};var _useForm=useForm(INITIAL_STATE,validateEditProfile,authenticateuser),handleSubmit=_useForm.handleSubmit,handleChange=_useForm.handleChange,setValues=_useForm.setValues,values=_useForm.values,isSubmitting=_useForm.isSubmitting;var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),busy=_React$useState2[0],setBusy=_React$useState2[1];function reauthenticate(_x,_x2){return _reauthenticate.apply(this,arguments);}function _reauthenticate(){_reauthenticate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(email,password){var credential;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:credential=firebase.app.auth.EmailAuthProvider.credential(email,password);_context.prev=1;_context.next=4;return user.reauthenticateWithCredential(credential);case 4:console.log(\"Reauthentication is Successful.\");_context.next=11;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);console.error(\"Profile Update Error\",_context.t0);toast(_context.t0.message);case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,7]]);}));return _reauthenticate.apply(this,arguments);}function reauthenticate(_x3,_x4){return _reauthenticate2.apply(this,arguments);}function _reauthenticate2(){_reauthenticate2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email,password){var credential;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:credential=firebase.app.auth.EmailAuthProvider.credential(email,password);_context2.prev=1;_context2.next=4;return user.reauthenticateWithCredential(credential);case 4:console.log(\"Reauthentication Successful.\");_context2.next=11;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](1);console.error(\"Profile Update Error.\");toast(_context2.t0.message);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[1,7]]);}));return _reauthenticate2.apply(this,arguments);}function updateProfileItems(_x5,_x6,_x7){return _updateProfileItems.apply(this,arguments);}function _updateProfileItems(){_updateProfileItems=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(name,email,password){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return user.updateProfile({displayName:name});case 2:_context3.next=4;return user.updateEmail(email);case 4:if(!password){_context3.next=7;break;}_context3.next=7;return user.updatePassword(password);case 7:case\"end\":return _context3.stop();}}},_callee3);}));return _updateProfileItems.apply(this,arguments);}function authenticateuser(){return _authenticateuser.apply(this,arguments);}function _authenticateuser(){_authenticateuser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var name,email,currentPassword,newPassword,result;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:setBusy(true);name=values.name,email=values.email,currentPassword=values.currentPassword,newPassword=values.newPassword;_context4.prev=2;_context4.next=5;return reauthenticate(user.email,currentPassword);case 5:_context4.next=7;return updateProfileItems(name,email,newPassword);case 7:_context4.next=9;return firebase.login(email,newPassword||currentPassword);case 9:result=_context4.sent;setValues({name:user&&user.displayName,email:user&&user.email,newPassword:\"\",currentPassword:\"\"});setUser(result.user);toast(\"You have updated your profile successfully.\");props.history.push(\"/profile\");_context4.next=20;break;case 16:_context4.prev=16;_context4.t0=_context4[\"catch\"](2);console.error(\"Profile Update Error\",_context4.t0);toast(_context4.t0.message);case 20:setBusy(false);case 21:case\"end\":return _context4.stop();}}},_callee4,null,[[2,16]]);}));return _authenticateuser.apply(this,arguments);}return/*#__PURE__*/React.createElement(IonPage,null,/*#__PURE__*/React.createElement(NavHeader,{title:\"Edit Profile\"}),/*#__PURE__*/React.createElement(IonLoading,{message:\"Please wait...\",isOpen:busy}),/*#__PURE__*/React.createElement(IonContent,null,/*#__PURE__*/React.createElement(IonItem,{lines:\"full\"},/*#__PURE__*/React.createElement(IonLabel,{position:\"floating\"},\"Username\"),/*#__PURE__*/React.createElement(IonInput,{name:\"name\",type:\"text\",value:values.name,onIonChange:handleChange,required:true})),/*#__PURE__*/React.createElement(IonItem,{lines:\"full\"},/*#__PURE__*/React.createElement(IonLabel,{position:\"floating\"},\"Email\"),/*#__PURE__*/React.createElement(IonInput,{name:\"email\",type:\"text\",value:values.email,onIonChange:handleChange,required:true})),/*#__PURE__*/React.createElement(IonItem,{lines:\"full\"},/*#__PURE__*/React.createElement(IonLabel,{position:\"floating\"},\"New Password\"),/*#__PURE__*/React.createElement(IonInput,{name:\"newPassword\",type:\"password\",value:values.newPassword,onIonChange:handleChange,required:true})),/*#__PURE__*/React.createElement(IonItem,{lines:\"full\"},/*#__PURE__*/React.createElement(IonLabel,{position:\"floating\"},\"Current Password\"),/*#__PURE__*/React.createElement(IonInput,{name:\"currentPassword\",type:\"password\",value:values.currentPassword,onIonChange:handleChange,required:true})),/*#__PURE__*/React.createElement(IonRow,null,/*#__PURE__*/React.createElement(IonCol,null,/*#__PURE__*/React.createElement(IonButton,{type:\"submit\",color:\"primary\",expand:\"block\",onClick:handleSubmit,disabled:isSubmitting},\"Save\")))));};export default EditProfile;","map":{"version":3,"sources":["C:/Users/shrey/Desktop/ReactProject/Newsy/src/pages/Auth/EditProfile.js"],"names":["React","UserContext","useForm","toast","IonPage","IonLoading","IonContent","IonItem","IonLabel","IonInput","IonRow","IonCol","IonButton","NavHeader","firebase","validateEditProfile","EditProfile","props","useContext","user","setUser","INITIAL_STATE","name","displayName","email","newPassword","currentPassword","authenticateuser","handleSubmit","handleChange","setValues","values","isSubmitting","useState","busy","setBusy","reauthenticate","password","credential","app","auth","EmailAuthProvider","reauthenticateWithCredential","console","log","error","message","updateProfileItems","updateProfile","updateEmail","updatePassword","login","result","history","push"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport UserContext from \"../../contexts/UserContext\";\r\nimport useForm from \"../../hooks/useForm\";\r\nimport { toast } from \"../../helpers/toast\";\r\nimport {\r\n  IonPage,\r\n  IonLoading,\r\n  IonContent,\r\n  IonItem,\r\n  IonLabel,\r\n  IonInput,\r\n  IonRow,\r\n  IonCol,\r\n  IonButton,\r\n} from \"@ionic/react\";\r\nimport NavHeader from \"../../components/Header/NavHeader\";\r\nimport firebase from \"../../firebase\";\r\nimport validateEditProfile from \"../../validators/validateEditProfile\";\r\n\r\nconst EditProfile = (props) => {\r\n  const { user, setUser } = React.useContext(UserContext);\r\n  const INITIAL_STATE = {\r\n    name: user && user.displayName,\r\n    email: user && user.email,\r\n    newPassword: \"\",\r\n    currentPassword: \"\",\r\n  };\r\n  const {\r\n    handleSubmit,\r\n    handleChange,\r\n    setValues,\r\n    values,\r\n    isSubmitting,\r\n  } = useForm(INITIAL_STATE, validateEditProfile, authenticateuser);\r\n  const [busy, setBusy] = React.useState(false);\r\n\r\n  async function reauthenticate(email, password) {\r\n    const credential = firebase.app.auth.EmailAuthProvider.credential(\r\n      email,\r\n      password\r\n    );\r\n    try {\r\n      await user.reauthenticateWithCredential(credential);\r\n      console.log(\"Reauthentication is Successful.\");\r\n    } catch (err) {\r\n      console.error(\"Profile Update Error\", err);\r\n      toast(err.message);\r\n    }\r\n  }\r\n\r\n  async function reauthenticate(email, password) {\r\n    const credential = firebase.app.auth.EmailAuthProvider.credential(\r\n      email,\r\n      password\r\n    );\r\n    try {\r\n      await user.reauthenticateWithCredential(credential);\r\n      console.log(\"Reauthentication Successful.\");\r\n    } catch (err) {\r\n      console.error(\"Profile Update Error.\");\r\n      toast(err.message);\r\n    }\r\n  }\r\n\r\n  async function updateProfileItems(name, email, password) {\r\n    await user.updateProfile({\r\n      displayName: name,\r\n    });\r\n    await user.updateEmail(email);\r\n    if (password) {\r\n      await user.updatePassword(password);\r\n    }\r\n  }\r\n\r\n  async function authenticateuser() {\r\n    setBusy(true);\r\n    const { name, email, currentPassword, newPassword } = values;\r\n    try {\r\n      await reauthenticate(user.email, currentPassword);\r\n      await updateProfileItems(name, email, newPassword);\r\n      const result = await firebase.login(\r\n        email,\r\n        newPassword || currentPassword\r\n      );\r\n      setValues({\r\n        name: user && user.displayName,\r\n        email: user && user.email,\r\n        newPassword: \"\",\r\n        currentPassword: \"\",\r\n      });\r\n      setUser(result.user);\r\n      toast(\"You have updated your profile successfully.\");\r\n      props.history.push(\"/profile\");\r\n    } catch (err) {\r\n      console.error(\"Profile Update Error\", err);\r\n      toast(err.message);\r\n    }\r\n    setBusy(false);\r\n  }\r\n\r\n  return (\r\n    <IonPage>\r\n      <NavHeader title=\"Edit Profile\" />\r\n      <IonLoading message={\"Please wait...\"} isOpen={busy} />\r\n      <IonContent>\r\n        <IonItem lines=\"full\">\r\n          <IonLabel position=\"floating\">Username</IonLabel>\r\n          <IonInput\r\n            name=\"name\"\r\n            type=\"text\"\r\n            value={values.name}\r\n            onIonChange={handleChange}\r\n            required\r\n          ></IonInput>\r\n        </IonItem>\r\n\r\n        <IonItem lines=\"full\">\r\n          <IonLabel position=\"floating\">Email</IonLabel>\r\n          <IonInput\r\n            name=\"email\"\r\n            type=\"text\"\r\n            value={values.email}\r\n            onIonChange={handleChange}\r\n            required\r\n          ></IonInput>\r\n        </IonItem>\r\n\r\n        <IonItem lines=\"full\">\r\n          <IonLabel position=\"floating\">New Password</IonLabel>\r\n          <IonInput\r\n            name=\"newPassword\"\r\n            type=\"password\"\r\n            value={values.newPassword}\r\n            onIonChange={handleChange}\r\n            required\r\n          ></IonInput>\r\n        </IonItem>\r\n\r\n        <IonItem lines=\"full\">\r\n          <IonLabel position=\"floating\">Current Password</IonLabel>\r\n          <IonInput\r\n            name=\"currentPassword\"\r\n            type=\"password\"\r\n            value={values.currentPassword}\r\n            onIonChange={handleChange}\r\n            required\r\n          ></IonInput>\r\n        </IonItem>\r\n\r\n        <IonRow>\r\n          <IonCol>\r\n            <IonButton\r\n              type=\"submit\"\r\n              color=\"primary\"\r\n              expand=\"block\"\r\n              onClick={handleSubmit}\r\n              disabled={isSubmitting}\r\n            >\r\n              Save\r\n            </IonButton>\r\n          </IonCol>\r\n        </IonRow>\r\n      </IonContent>\r\n    </IonPage>\r\n  );\r\n};\r\n\r\nexport default EditProfile;\r\n"]},"metadata":{},"sourceType":"module"}