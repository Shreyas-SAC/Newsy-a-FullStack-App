{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\shrey\\\\Desktop\\\\reactproject\\\\Newsy\\\\src\\\\pages\\\\Link.js\";\nimport React from \"react\";\nimport firebase from \"../firebase\";\nimport { Plugins } from \"@capacitor/core\";\nimport UserContext from \"../contexts/UserContext\";\nimport { IonPage, IonContent, IonGrid, IonRow, IonCol, IonButton } from \"@ionic/react\";\nimport NavHeader from \"../components/Header/NavHeader\";\nimport { closeCircleOutline } from \"ionicons/icons\";\nimport LinkItem from \"../components/Link/LinkItem\";\nimport CommentModal from \"../components/Link/CommentModal\";\nconst {\n  Browser\n} = Plugins;\n\nconst Link = props => {\n  const {\n    user\n  } = React.useContext(UserContext);\n  const [link, setLink] = React.useState(null);\n  const [showModal, setShowModal] = React.useState(false);\n  const linkId = props.match.params.linkId;\n  const linkRef = firebase.db.collection(\"links\").doc(linkId);\n  React.useEffect(() => {\n    getLink(); // eslint-disable-next-line\n  }, [linkId]);\n\n  function getLink() {\n    linkRef.get().then(doc => {\n      setLink({ ...doc.data(),\n        id: doc.id\n      });\n    });\n  }\n\n  function handleOpenModal() {\n    if (!user) {\n      props.history.push(\"/login\");\n    } else {\n      setShowModal(true);\n    }\n  }\n\n  function handleCloseModal() {\n    setShowModal(false);\n  }\n\n  function handleAddComment(commentText) {\n    if (!user) {\n      props.history.push(\"/login\");\n    } else {\n      linkRef.get().then(doc => {\n        if (doc.exists) {\n          const previousComments = doc.data().comments;\n          const newComment = {\n            postedBy: {\n              id: user.uid,\n              name: user.displayName\n            },\n            created: Date.now(),\n            text: commentText\n          };\n          const updatedComments = [...previousComments, newComment];\n          linkRef.update({\n            comments: updatedComments\n          });\n          setLink(prevState => ({ ...prevState,\n            comments: updatedComments\n          }));\n        }\n      });\n      setShowModal(false);\n    }\n  }\n\n  function handleAddVote() {\n    if (!user) {\n      props.history.push(\"/login\");\n    } else {\n      linkRef.get().then(doc => {\n        if (doc.exists) {\n          const previousVotes = doc.data().votes;\n          const vote = {\n            voteBy: {\n              id: user.uid,\n              name: user.displayName\n            }\n          };\n          const updatedVotes = [...previousVotes, vote];\n          const voteCount = updatedVotes.length;\n          linkRef.update({\n            votes: updatedVotes,\n            voteCount\n          });\n          setLink(prevState => ({ ...prevState,\n            votes: updatedVotes,\n            voteCount: voteCount\n          }));\n        }\n      });\n    }\n  }\n\n  function handleDeleteLink() {\n    linkRef.delete().then(() => {\n      console.log(`Document with ID ${link.id} deleted`);\n    }).catch(err => {\n      console.error(\"Error deleting document\", err);\n    });\n    props.history.push(\"/\");\n  }\n\n  function postedByAuthUser(link) {\n    return user && user.uid === link.postedBy.id;\n  }\n\n  async function openBrowser() {\n    await Browser.open({\n      url: link.url\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(IonPage, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(NavHeader, {\n    title: link && link.description,\n    option: link && postedByAuthUser(link),\n    icon: closeCircleOutline,\n    action: handleDeleteLink,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(IonContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(CommentModal, {\n    isOpen: showModal,\n    title: \"New Comment\",\n    sendAction: handleAddComment,\n    closeAction: handleCloseModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 9\n    }\n  }), link && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(IonGrid, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(IonRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(IonCol, {\n    class: \"ion-text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(LinkItem, {\n    link: link,\n    browser: openBrowser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(IonButton, {\n    onClick: () => handleAddVote(),\n    size: \"small\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 19\n    }\n  }, \"Upvote\"), /*#__PURE__*/React.createElement(IonButton, {\n    onClick: () => handleOpenModal(),\n    size: \"small\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 19\n    }\n  }, \"Comment\")))))));\n};\n\nexport default Link;","map":{"version":3,"sources":["C:/Users/shrey/Desktop/reactproject/Newsy/src/pages/Link.js"],"names":["React","firebase","Plugins","UserContext","IonPage","IonContent","IonGrid","IonRow","IonCol","IonButton","NavHeader","closeCircleOutline","LinkItem","CommentModal","Browser","Link","props","user","useContext","link","setLink","useState","showModal","setShowModal","linkId","match","params","linkRef","db","collection","doc","useEffect","getLink","get","then","data","id","handleOpenModal","history","push","handleCloseModal","handleAddComment","commentText","exists","previousComments","comments","newComment","postedBy","uid","name","displayName","created","Date","now","text","updatedComments","update","prevState","handleAddVote","previousVotes","votes","vote","voteBy","updatedVotes","voteCount","length","handleDeleteLink","delete","console","log","catch","err","error","postedByAuthUser","openBrowser","open","url","description"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport firebase from \"../firebase\";\r\nimport { Plugins } from \"@capacitor/core\";\r\nimport UserContext from \"../contexts/UserContext\";\r\nimport {\r\n  IonPage,\r\n  IonContent,\r\n  IonGrid,\r\n  IonRow,\r\n  IonCol,\r\n  IonButton,\r\n} from \"@ionic/react\";\r\nimport NavHeader from \"../components/Header/NavHeader\";\r\nimport { closeCircleOutline } from \"ionicons/icons\";\r\nimport LinkItem from \"../components/Link/LinkItem\";\r\nimport CommentModal from \"../components/Link/CommentModal\";\r\n\r\nconst { Browser } = Plugins;\r\n\r\nconst Link = (props) => {\r\n  const { user } = React.useContext(UserContext);\r\n  const [link, setLink] = React.useState(null);\r\n  const [showModal, setShowModal] = React.useState(false);\r\n  const linkId = props.match.params.linkId;\r\n  const linkRef = firebase.db.collection(\"links\").doc(linkId);\r\n\r\n  React.useEffect(() => {\r\n    getLink();\r\n    // eslint-disable-next-line\r\n  }, [linkId]);\r\n\r\n  function getLink() {\r\n    linkRef.get().then((doc) => {\r\n      setLink({ ...doc.data(), id: doc.id });\r\n    });\r\n  }\r\n\r\n  function handleOpenModal() {\r\n    if (!user) {\r\n      props.history.push(\"/login\");\r\n    } else {\r\n      setShowModal(true);\r\n    }\r\n  }\r\n\r\n  function handleCloseModal() {\r\n    setShowModal(false);\r\n  }\r\n\r\n  function handleAddComment(commentText) {\r\n    if (!user) {\r\n      props.history.push(\"/login\");\r\n    } else {\r\n      linkRef.get().then((doc) => {\r\n        if (doc.exists) {\r\n          const previousComments = doc.data().comments;\r\n          const newComment = {\r\n            postedBy: { id: user.uid, name: user.displayName },\r\n            created: Date.now(),\r\n            text: commentText,\r\n          };\r\n          const updatedComments = [...previousComments, newComment];\r\n          linkRef.update({ comments: updatedComments });\r\n          setLink((prevState) => ({\r\n            ...prevState,\r\n            comments: updatedComments,\r\n          }));\r\n        }\r\n      });\r\n      setShowModal(false);\r\n    }\r\n  }\r\n\r\n  function handleAddVote() {\r\n    if (!user) {\r\n      props.history.push(\"/login\");\r\n    } else {\r\n      linkRef.get().then((doc) => {\r\n        if (doc.exists) {\r\n          const previousVotes = doc.data().votes;\r\n          const vote = { voteBy: { id: user.uid, name: user.displayName } };\r\n          const updatedVotes = [...previousVotes, vote];\r\n          const voteCount = updatedVotes.length;\r\n          linkRef.update({ votes: updatedVotes, voteCount });\r\n          setLink((prevState) => ({\r\n            ...prevState,\r\n            votes: updatedVotes,\r\n            voteCount: voteCount,\r\n          }));\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function handleDeleteLink() {\r\n    linkRef\r\n      .delete()\r\n      .then(() => {\r\n        console.log(`Document with ID ${link.id} deleted`);\r\n      })\r\n      .catch((err) => {\r\n        console.error(\"Error deleting document\", err);\r\n      });\r\n    props.history.push(\"/\");\r\n  }\r\n\r\n  function postedByAuthUser(link) {\r\n    return user && user.uid === link.postedBy.id;\r\n  }\r\n\r\n  async function openBrowser() {\r\n    await Browser.open({\r\n      url: link.url,\r\n    });\r\n  }\r\n\r\n  return (\r\n    <IonPage>\r\n      <NavHeader\r\n        title={link && link.description}\r\n        option={link && postedByAuthUser(link)}\r\n        icon={closeCircleOutline}\r\n        action={handleDeleteLink}\r\n      />\r\n      <IonContent>\r\n        <CommentModal\r\n          isOpen={showModal}\r\n          title=\"New Comment\"\r\n          sendAction={handleAddComment}\r\n          closeAction={handleCloseModal}\r\n        />\r\n        {link && (\r\n          <>\r\n            <IonGrid>\r\n              <IonRow>\r\n                <IonCol class=\"ion-text-center\">\r\n                  <LinkItem link={link} browser={openBrowser} />\r\n                  <IonButton onClick={() => handleAddVote()} size=\"small\">\r\n                    Upvote\r\n                  </IonButton>\r\n                  <IonButton onClick={() => handleOpenModal()} size=\"small\">\r\n                    Comment\r\n                  </IonButton>\r\n                </IonCol>\r\n              </IonRow>\r\n            </IonGrid>\r\n          </>\r\n        )}\r\n      </IonContent>\r\n    </IonPage>\r\n  );\r\n};\r\n\r\nexport default Link;\r\n"]},"metadata":{},"sourceType":"module"}